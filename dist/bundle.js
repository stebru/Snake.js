(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _tileProtoJs = require('./tileProto.js');

var _tileProtoJs2 = _interopRequireDefault(_tileProtoJs);

var _snakeProtoJs = require('./snakeProto.js');

var _snakeProtoJs2 = _interopRequireDefault(_snakeProtoJs);

var _settingsJs = require('./settings.js');

var _settingsJs2 = _interopRequireDefault(_settingsJs);

var boardProto = {

  getTileAt: function getTileAt(row, col) {
    var rowObj = this.rows[row];
    return rowObj.tiles[col];
  },

  addFruit: function addFruit() {

    var isTileOccupied = true;
    do {
      var rndRow = Math.floor(Math.random() * this.numRows);
      var rndCol = Math.floor(Math.random() * this.numCols);
      var tile = this.getTileAt(rndRow, rndCol);
      isTileOccupied = !!tile.occupiedBy;
    } while (isTileOccupied);

    tile.addFruit();
  },

  createMatrix: function createMatrix(boardElement) {

    this.rows = [];
    this.fragment = document.createDocumentFragment();
    var row, col;

    for (var i = 0; i < this.numRows; i++) {
      row = document.createElement('div');
      row.classList.add('row');

      var rowObj = Object.create(null);
      rowObj.index = i;
      rowObj.tiles = [];

      for (var j = 0; j < this.numCols; j++) {
        col = document.createElement('div');
        col.classList.add('col');
        row.appendChild(col);

        var tile = Object.create(_tileProtoJs2['default']);
        tile.index = j;
        tile.row = i;
        tile.col = j;
        tile.occupiedBy = null;

        tile.element = col;
        rowObj.tiles.push(tile);
      }
      this.rows.push(rowObj);
      this.fragment.appendChild(row);
    }
    boardElement.appendChild(this.fragment);
  },

  createSnake: function createSnake() {
    var directions = _settingsJs2['default'].directions;
    var snake = Object.create(_snakeProtoJs2['default']);

    snake.direction = directions.RIGHT;
    snake.bodyParts = [];

    var head = Object.create({});
    head.isHead = true;
    head.tile = this.rows[4].tiles[5].addSnakePart(head);
    snake.bodyParts.push(head);

    var body = Object.create({});
    body.tile = this.rows[4].tiles[4].addSnakePart(body);
    snake.bodyParts.push(body);

    var body = Object.create({});
    body.tile = this.rows[4].tiles[3].addSnakePart(body);
    snake.bodyParts.push(body);

    this.snake = snake;
  },

  clear: function clear(game) {
    this.snake = null;
    game.boardElement.innerHTML = null;
    game.scoreElement.innerHTML = '0';
  },

  draw: function draw(snake) {
    var snakeHead = this.snake.getHead();
    var moveToRow, moveToCol;
    var directions = _settingsJs2['default'].directions;

    switch (this.snake.direction) {
      case directions.UP:
        moveToRow = snakeHead.tile.row - 1;
        moveToCol = snakeHead.tile.col;
        break;
      case directions.DOWN:
        moveToRow = snakeHead.tile.row + 1;
        moveToCol = snakeHead.tile.col;
        break;
      case directions.RIGHT:
        moveToRow = snakeHead.tile.row;
        moveToCol = snakeHead.tile.col + 1;
        break;
      case directions.LEFT:
        moveToRow = snakeHead.tile.row;
        moveToCol = snakeHead.tile.col - 1;
        break;
    }

    if (moveToRow < 0) {
      moveToRow = this.numRows - 1;
    } else if (moveToRow > this.numRows - 1) {
      moveToRow = 0;
    } else if (moveToCol > this.numRows - 1) {
      moveToCol = 0;
    } else if (moveToCol < 0) {
      moveToCol = this.numRows - 1;
    }

    var moveToTile = this.getTileAt(moveToRow, moveToCol);

    for (var b = 0; b < this.snake.bodyParts.length; b++) {

      var currentBodyPart = this.snake.bodyParts[b];
      var prevTile = currentBodyPart.tile;

      currentBodyPart.tile = moveToTile.addSnakePart(currentBodyPart);
      if (currentBodyPart.tile === false) {
        break;
      }
      prevTile.removeSnakePart();
      moveToTile = prevTile;
    }
  }
};

exports['default'] = boardProto;
module.exports = exports['default'];

},{"./settings.js":4,"./snakeProto.js":5,"./tileProto.js":6}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _boardProtoJs = require('./boardProto.js');

var _boardProtoJs2 = _interopRequireDefault(_boardProtoJs);

var _settingsJs = require('./settings.js');

var _settingsJs2 = _interopRequireDefault(_settingsJs);

var game = Object.create({
  updateScore: function updateScore() {
    this.score += this.nextScore;
    this.scoreElement.innerHTML = this.score;
    this.speed -= 1;
    this.nextScore += 5;
  },

  resetScore: function resetScore() {
    this.score = 0;
    this.scoreElement.innerHTML = this.score;
  },

  gameOver: function gameOver() {
    window.cancelAnimationFrame(this.raf);
  },

  start: function start() {
    this.boardElement = document.getElementById('board');
    this.scoreElement = document.getElementById('score');

    if (this.board) {
      this.board.clear(this);
    }

    this.gameOver();
    this.resetScore();

    this.board = Object.create(_boardProtoJs2['default']);
    this.board.numRows = 20;
    this.board.numCols = 20;
    this.board.createMatrix(this.boardElement);

    this.board.createSnake();
    this.board.addFruit();

    this.score = 0;
    this.speed = 100;
    this.lastTick = 0;
    this.nextScore = 10;

    this.listen();

    window.requestAnimationFrame(this.run.bind(this));
  },

  listen: function listen() {
    if (this.listener) {
      document.removeEventListener('keydown', this.listener);
    }
    this.listener = this.keys.bind(this);
    document.addEventListener('keydown', this.listener);
  },

  keys: function keys(event) {

    var snake = this.board.snake,
        keycodes = _settingsJs2['default'].keycodes,
        directions = _settingsJs2['default'].directions;

    if (event.keyCode === keycodes.UP && snake.direction !== directions.DOWN) {
      snake.direction = directions.UP;
    } else if (event.keyCode === keycodes.DOWN && snake.direction !== directions.UP) {
      snake.direction = directions.DOWN;
    } else if (event.keyCode === keycodes.RIGHT && snake.direction !== directions.LEFT) {
      snake.direction = directions.RIGHT;
    } else if (event.keyCode === keycodes.LEFT && snake.direction !== directions.RIGHT) {
      snake.direction = directions.LEFT;
    }

    if (event.keyCode === keycodes.SPACE) {
      game.start();
    }
  },

  run: function run(timestamp) {
    this.raf = window.requestAnimationFrame(this.run.bind(this));

    if (timestamp - this.lastTick < this.speed) {
      return false;
    }
    this.lastTick = timestamp;

    this.board.draw();
  }
});

exports['default'] = game;
module.exports = exports['default'];

},{"./boardProto.js":1,"./settings.js":4}],3:[function(require,module,exports){
'use strict';

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _gameJs = require('./game.js');

var _gameJs2 = _interopRequireDefault(_gameJs);

_gameJs2['default'].start();

},{"./game.js":2}],4:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
	value: true
});
var directions = {
	UP: 1,
	DOWN: 2,
	LEFT: 4,
	RIGHT: 8
};

var keycodes = {
	UP: 38,
	DOWN: 40,
	RIGHT: 39,
	LEFT: 37,
	SPACE: 32
};

exports["default"] = {
	directions: directions,
	keycodes: keycodes
};
module.exports = exports["default"];

},{}],5:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
	value: true
});
var snakeProto = {
	getLength: function getLength() {
		return this.bodyParts.length;
	},

	getHead: function getHead() {
		return this.bodyParts[0];
	},

	getTail: function getTail() {
		return this.bodyParts[this.bodyParts.length - 1];
	}
};

exports["default"] = snakeProto;
module.exports = exports["default"];

},{}],6:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _gameJs = require('./game.js');

var _gameJs2 = _interopRequireDefault(_gameJs);

var tileProto = {
  paintSnakePart: function paintSnakePart() {
    this.element.classList.add('on');
    if (this.occupiedBy.isHead) {
      this.element.classList.add('head');
    }
  },

  clearTile: function clearTile() {
    this.element.classList.remove('on', 'head');
  },

  addSnakePart: function addSnakePart(snakePart) {
    if (this.hasFruit) {
      this.removeFruit();
      _gameJs2['default'].updateScore();
      var body = Object.create({});
      var tailTile = _gameJs2['default'].board.snake.bodyParts[_gameJs2['default'].board.snake.bodyParts.length - 1].tile;
      body.tile = tailTile.addSnakePart(body);
      _gameJs2['default'].board.snake.bodyParts.push(body);
      _gameJs2['default'].board.addFruit();
    } else if (snakePart.isHead && this.occupiedBy) {
      _gameJs2['default'].gameOver();
      return false;
    }
    this.occupiedBy = snakePart;
    snakePart.tile = this;
    this.paintSnakePart();
    return this;
  },

  removeSnakePart: function removeSnakePart() {
    this.occupiedBy = null;
    this.clearTile();
    return this;
  },

  hasSnakePart: function hasSnakePart() {
    return this.occupiedBy != null;
  },

  addFruit: function addFruit() {
    this.hasFruit = true;
    this.paintFruit();
  },

  removeFruit: function removeFruit() {
    this.hasFruit = false;
    this.element.classList.remove('fruit');
  },

  paintFruit: function paintFruit() {
    this.element.classList.add('fruit');
  }
};

exports['default'] = tileProto;
module.exports = exports['default'];

},{"./game.js":2}]},{},[3])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvc3RlZmFuYnJ1dmlrL2dpdC9zbmFrZS9zcmMvYm9hcmRQcm90by5qcyIsIi9Vc2Vycy9zdGVmYW5icnV2aWsvZ2l0L3NuYWtlL3NyYy9nYW1lLmpzIiwiL1VzZXJzL3N0ZWZhbmJydXZpay9naXQvc25ha2Uvc3JjL2luZGV4LmpzIiwiL1VzZXJzL3N0ZWZhbmJydXZpay9naXQvc25ha2Uvc3JjL3NldHRpbmdzLmpzIiwiL1VzZXJzL3N0ZWZhbmJydXZpay9naXQvc25ha2Uvc3JjL3NuYWtlUHJvdG8uanMiLCIvVXNlcnMvc3RlZmFuYnJ1dmlrL2dpdC9zbmFrZS9zcmMvdGlsZVByb3RvLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7MkJDQXNCLGdCQUFnQjs7Ozs0QkFDZixpQkFBaUI7Ozs7MEJBQ25CLGVBQWU7Ozs7QUFFcEMsSUFBSSxVQUFVLEdBQUc7O0FBRWYsV0FBUyxFQUFBLG1CQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUU7QUFDbEIsUUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUM1QixXQUFPLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7R0FDMUI7O0FBRUQsVUFBUSxFQUFBLG9CQUFHOztBQUVULFFBQUksY0FBYyxHQUFHLElBQUksQ0FBQztBQUMxQixPQUFHO0FBQ0QsVUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQ3RELFVBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUN0RCxVQUFJLElBQUksR0FBRyxJQUFJ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QUFLLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztLQUN2QixNQUFNLElBQUksU0FBUyxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFO0FBQzlDLDBCQUFLLFFBQVEsRUFBRSxDQUFDO0FBQ2hCLGFBQU8sS0FBSyxDQUFDO0tBQ2Q7QUFDRCxRQUFJLENBQUMsVUFBVSxHQUFHLFNBQVMsQ0FBQztBQUM1QixhQUFTLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztBQUN0QixRQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7QUFDdEIsV0FBTyxJQUFJLENBQUM7R0FDYjs7QUFFRCxpQkFBZSxFQUFBLDJCQUFHO0FBQ2hCLFFBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO0FBQ3ZCLFFBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztBQUNqQixXQUFPLElBQUksQ0FBQztHQUNiOztBQUVELGNBQVksRUFBQSx3QkFBRztBQUNiLFdBQU8sSUFBSSxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUM7R0FDaEM7O0FBRUQsVUFBUSxFQUFBLG9CQUFHO0FBQ1QsUUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7QUFDckIsUUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO0dBQ25COztBQUVELGFBQVcsRUFBQSx1QkFBRztBQUNaLFFBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO0FBQ3RCLFFBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztHQUN4Qzs7QUFFRCxZQUFVLEVBQUEsc0JBQUc7QUFDWCxRQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7R0FDckM7Q0FDRixDQUFDOztxQkFHTSxTQUFTIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsImltcG9ydCB0aWxlUHJvdG8gZnJvbSAnLi90aWxlUHJvdG8uanMnO1xuaW1wb3J0IHNuYWtlUHJvdG8gZnJvbSAnLi9zbmFrZVByb3RvLmpzJztcbmltcG9ydCBzZXR0aW5ncyBmcm9tICcuL3NldHRpbmdzLmpzJztcblxudmFyIGJvYXJkUHJvdG8gPSB7XG5cbiAgZ2V0VGlsZUF0KHJvdywgY29sKSB7XG4gICAgdmFyIHJvd09iaiA9IHRoaXMucm93c1tyb3ddO1xuICAgIHJldHVybiByb3dPYmoudGlsZXNbY29sXTtcbiAgfSxcblxuICBhZGRGcnVpdCgpIHtcblxuICAgIHZhciBpc1RpbGVPY2N1cGllZCA9IHRydWU7XG4gICAgZG8ge1xuICAgICAgdmFyIHJuZFJvdyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMubnVtUm93cyk7XG4gICAgICB2YXIgcm5kQ29sID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdGhpcy5udW1Db2xzKTtcbiAgICAgIHZhciB0aWxlID0gdGhpcy5nZXRUaWxlQXQocm5kUm93LCBybmRDb2wpO1xuICAgICAgaXNUaWxlT2NjdXBpZWQgPSAhIXRpbGUub2NjdXBpZWRCeTtcbiAgICB9IHdoaWxlIChpc1RpbGVPY2N1cGllZCk7XG5cbiAgICB0aWxlLmFkZEZydWl0KCk7XG4gIH0sXG5cbiAgY3JlYXRlTWF0cml4KGJvYXJkRWxlbWVudCkge1xuXG4gICAgdGhpcy5yb3dzID0gW107XG4gICAgdGhpcy5mcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICB2YXIgcm93LCBjb2w7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubnVtUm93czsgaSsrKSB7XG4gICAgICByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIHJvdy5jbGFzc0xpc3QuYWRkKCdyb3cnKTtcblxuICAgICAgdmFyIHJvd09iaiA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgICByb3dPYmouaW5kZXggPSBpO1xuICAgICAgcm93T2JqLnRpbGVzID0gW107XG5cbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdGhpcy5udW1Db2xzOyBqKyspIHtcbiAgICAgICAgY29sID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGNvbC5jbGFzc0xpc3QuYWRkKCdjb2wnKTtcbiAgICAgICAgcm93LmFwcGVuZENoaWxkKGNvbCk7XG5cbiAgICAgICAgdmFyIHRpbGUgPSBPYmplY3QuY3JlYXRlKHRpbGVQcm90byk7XG4gICAgICAgIHRpbGUuaW5kZXggPSBqO1xuICAgICAgICB0aWxlLnJvdyA9IGk7XG4gICAgICAgIHRpbGUuY29sID0gajtcbiAgICAgICAgdGlsZS5vY2N1cGllZEJ5ID0gbnVsbDtcblxuICAgICAgICB0aWxlLmVsZW1lbnQgPSBjb2w7XG4gICAgICAgIHJvd09iai50aWxlcy5wdXNoKHRpbGUpO1xuICAgICAgfVxuICAgICAgdGhpcy5yb3dzLnB1c2gocm93T2JqKTtcbiAgICAgIHRoaXMuZnJhZ21lbnQuYXBwZW5kQ2hpbGQocm93KTtcbiAgICB9XG4gICAgYm9hcmRFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuZnJhZ21lbnQpO1xuICB9LFxuXG4gIGNyZWF0ZVNuYWtlKCkge1xuICAgIHZhciBkaXJlY3Rpb25zID0gc2V0dGluZ3MuZGlyZWN0aW9ucztcbiAgICB2YXIgc25ha2UgPSBPYmplY3QuY3JlYXRlKHNuYWtlUHJvdG8pO1xuXG4gICAgc25ha2UuZGlyZWN0aW9uID0gZGlyZWN0aW9ucy5SSUdIVDtcbiAgICBzbmFrZS5ib2R5UGFydHMgPSBbXTtcblxuICAgIHZhciBoZWFkID0gT2JqZWN0LmNyZWF0ZSh7fSk7XG4gICAgaGVhZC5pc0hlYWQgPSB0cnVlO1xuICAgIGhlYWQudGlsZSA9IHRoaXMucm93c1s0XS50aWxlc1s1XS5hZGRTbmFrZVBhcnQoaGVhZCk7XG4gICAgc25ha2UuYm9keVBhcnRzLnB1c2goaGVhZCk7XG5cbiAgICB2YXIgYm9keSA9IE9iamVjdC5jcmVhdGUoe30pO1xuICAgIGJvZHkudGlsZSA9IHRoaXMucm93c1s0XS50aWxlc1s0XS5hZGRTbmFrZVBhcnQoYm9keSk7XG4gICAgc25ha2UuYm9keVBhcnRzLnB1c2goYm9keSk7XG5cbiAgICB2YXIgYm9keSA9IE9iamVjdC5jcmVhdGUoe30pO1xuICAgIGJvZHkudGlsZSA9IHRoaXMucm93c1s0XS50aWxlc1szXS5hZGRTbmFrZVBhcnQoYm9keSk7XG4gICAgc25ha2UuYm9keVBhcnRzLnB1c2goYm9keSk7XG5cbiAgICB0aGlzLnNuYWtlID0gc25ha2U7XG4gIH0sXG5cbiAgY2xlYXIoZ2FtZSkge1xuICAgIHRoaXMuc25ha2UgPSBudWxsO1xuICAgIGdhbWUuYm9hcmRFbGVtZW50LmlubmVySFRNTCA9IG51bGw7XG4gICAgZ2FtZS5zY29yZUVsZW1lbnQuaW5uZXJIVE1MID0gJzAnO1xuICB9LFxuXG4gIGRyYXcoc25ha2UpIHtcbiAgICB2YXIgc25ha2VIZWFkID0gdGhpcy5zbmFrZS5nZXRIZWFkKCk7XG4gICAgdmFyIG1vdmVUb1JvdywgbW92ZVRvQ29sO1xuICAgIHZhciBkaXJlY3Rpb25zID0gc2V0dGluZ3MuZGlyZWN0aW9ucztcblxuICAgIHN3aXRjaCAodGhpcy5zbmFrZS5kaXJlY3Rpb24pIHtcbiAgICAgIGNhc2UgZGlyZWN0aW9ucy5VUDpcbiAgICAgICAgbW92ZVRvUm93ID0gc25ha2VIZWFkLnRpbGUucm93IC0gMTtcbiAgICAgICAgbW92ZVRvQ29sID0gc25ha2VIZWFkLnRpbGUuY29sO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgZGlyZWN0aW9ucy5ET1dOOlxuICAgICAgICBtb3ZlVG9Sb3cgPSBzbmFrZUhlYWQudGlsZS5yb3cgKyAxO1xuICAgICAgICBtb3ZlVG9Db2wgPSBzbmFrZUhlYWQudGlsZS5jb2w7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBkaXJlY3Rpb25zLlJJR0hUOlxuICAgICAgICBtb3ZlVG9Sb3cgPSBzbmFrZUhlYWQudGlsZS5yb3c7XG4gICAgICAgIG1vdmVUb0NvbCA9IHNuYWtlSGVhZC50aWxlLmNvbCArIDE7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBkaXJlY3Rpb25zLkxFRlQ6XG4gICAgICAgIG1vdmVUb1JvdyA9IHNuYWtlSGVhZC50aWxlLnJvdztcbiAgICAgICAgbW92ZVRvQ29sID0gc25ha2VIZWFkLnRpbGUuY29sIC0gMTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgaWYgKG1vdmVUb1JvdyA8IDApIHtcbiAgICAgIG1vdmVUb1JvdyA9IHRoaXMubnVtUm93cyAtIDE7XG4gICAgfSBlbHNlIGlmIChtb3ZlVG9Sb3cgPiB0aGlzLm51bVJvd3MgLSAxKSB7XG4gICAgICBtb3ZlVG9Sb3cgPSAwO1xuICAgIH0gZWxzZSBpZiAobW92ZVRvQ29sID4gdGhpcy5udW1Sb3dzIC0gMSkge1xuICAgICAgbW92ZVRvQ29sID0gMDtcbiAgICB9IGVsc2UgaWYgKG1vdmVUb0NvbCA8IDApIHtcbiAgICAgIG1vdmVUb0NvbCA9IHRoaXMubnVtUm93cyAtIDE7XG4gICAgfVxuXG4gICAgdmFyIG1vdmVUb1RpbGUgPSB0aGlzLmdldFRpbGVBdChtb3ZlVG9Sb3csIG1vdmVUb0NvbCk7XG5cbiAgICBmb3IgKHZhciBiID0gMDsgYiA8IHRoaXMuc25ha2UuYm9keVBhcnRzLmxlbmd0aDsgYisrKSB7XG5cbiAgICAgIHZhciBjdXJyZW50Qm9keVBhcnQgPSB0aGlzLnNuYWtlLmJvZHlQYXJ0c1tiXTtcbiAgICAgIHZhciBwcmV2VGlsZSA9IGN1cnJlbnRCb2R5UGFydC50aWxlO1xuXG4gICAgICBjdXJyZW50Qm9keVBhcnQudGlsZSA9IG1vdmVUb1RpbGUuYWRkU25ha2VQYXJ0KGN1cnJlbnRCb2R5UGFydCk7XG4gICAgICBpZiAoY3VycmVudEJvZHlQYXJ0LnRpbGUgPT09IGZhbHNlKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgcHJldlRpbGUucmVtb3ZlU25ha2VQYXJ0KCk7XG4gICAgICBtb3ZlVG9UaWxlID0gcHJldlRpbGU7XG4gICAgfVxuICB9XG59O1xuXG5leHBvcnRcbmRlZmF1bHQgYm9hcmRQcm90bztcbiIsImltcG9ydCBib2FyZFByb3RvIGZyb20gJy4vYm9hcmRQcm90by5qcyc7XG5pbXBvcnQgc2V0dGluZ3MgZnJvbSAnLi9zZXR0aW5ncy5qcyc7XG5cbnZhciBnYW1lID0gT2JqZWN0LmNyZWF0ZSh7XG4gIHVwZGF0ZVNjb3JlKCkge1xuICAgIHRoaXMuc2NvcmUgKz0gdGhpcy5uZXh0U2NvcmU7XG4gICAgdGhpcy5zY29yZUVsZW1lbnQuaW5uZXJIVE1MID0gdGhpcy5zY29yZTtcbiAgICB0aGlzLnNwZWVkIC09IDE7XG4gICAgdGhpcy5uZXh0U2NvcmUgKz0gNTtcbiAgfSxcblxuICByZXNldFNjb3JlKCkge1xuICAgIHRoaXMuc2NvcmUgPSAwO1xuICAgIHRoaXMuc2NvcmVFbGVtZW50LmlubmVySFRNTCA9IHRoaXMuc2NvcmU7XG4gIH0sXG5cbiAgZ2FtZU92ZXIoKSB7XG4gICAgd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMucmFmKTtcbiAgfSxcblxuICBzdGFydCgpIHtcbiAgICB0aGlzLmJvYXJkRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdib2FyZCcpO1xuICAgIHRoaXMuc2NvcmVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Njb3JlJyk7XG5cbiAgICBpZiAodGhpcy5ib2FyZCkge1xuICAgICAgdGhpcy5ib2FyZC5jbGVhcih0aGlzKTtcbiAgICB9XG5cbiAgICB0aGlzLmdhbWVPdmVyKCk7XG4gICAgdGhpcy5yZXNldFNjb3JlKCk7XG5cbiAgICB0aGlzLmJvYXJkID0gT2JqZWN0LmNyZWF0ZShib2FyZFByb3RvKTtcbiAgICB0aGlzLmJvYXJkLm51bVJvd3MgPSAyMDtcbiAgICB0aGlzLmJvYXJkLm51bUNvbHMgPSAyMDtcbiAgICB0aGlzLmJvYXJkLmNyZWF0ZU1hdHJpeCh0aGlzLmJvYXJkRWxlbWVudCk7XG5cbiAgICB0aGlzLmJvYXJkLmNyZWF0ZVNuYWtlKCk7XG4gICAgdGhpcy5ib2FyZC5hZGRGcnVpdCgpO1xuXG4gICAgdGhpcy5zY29yZSA9IDA7XG4gICAgdGhpcy5zcGVlZCA9IDEwMDtcbiAgICB0aGlzLmxhc3RUaWNrID0gMDtcbiAgICB0aGlzLm5leHRTY29yZSA9IDEwO1xuXG4gICAgdGhpcy5saXN0ZW4oKTtcblxuICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5ydW4uYmluZCh0aGlzKSk7XG4gIH0sXG5cbiAgbGlzdGVuKCkge1xuICAgIGlmICh0aGlzLmxpc3RlbmVyKSB7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5saXN0ZW5lcik7XG4gICAgfVxuICAgIHRoaXMubGlzdGVuZXIgPSB0aGlzLmtleXMuYmluZCh0aGlzKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5saXN0ZW5lcik7XG4gIH0sXG5cbiAga2V5cyhldmVudCkge1xuXG4gICAgdmFyIHNuYWtlID0gdGhpcy5ib2FyZC5zbmFrZSxcbiAgICAgIGtleWNvZGVzID0gc2V0dGluZ3Mua2V5Y29kZXMsXG4gICAgICBkaXJlY3Rpb25zID0gc2V0dGluZ3MuZGlyZWN0aW9ucztcblxuICAgIGlmIChldmVudC5rZXlDb2RlID09PSBrZXljb2Rlcy5VUCAmJiBzbmFrZS5kaXJlY3Rpb24gIT09IGRpcmVjdGlvbnMuRE9XTikge1xuICAgICAgc25ha2UuZGlyZWN0aW9uID0gZGlyZWN0aW9ucy5VUDtcbiAgICB9IGVsc2UgaWYgKGV2ZW50LmtleUNvZGUgPT09IGtleWNvZGVzLkRPV04gJiYgc25ha2UuZGlyZWN0aW9uICE9PSBkaXJlY3Rpb25zLlVQKSB7XG4gICAgICBzbmFrZS5kaXJlY3Rpb24gPSBkaXJlY3Rpb25zLkRPV047XG4gICAgfSBlbHNlIGlmIChldmVudC5rZXlDb2RlID09PSBrZXljb2Rlcy5SSUdIVCAmJiBzbmFrZS5kaXJlY3Rpb24gIT09IGRpcmVjdGlvbnMuTEVGVCkge1xuICAgICAgc25ha2UuZGlyZWN0aW9uID0gZGlyZWN0aW9ucy5SSUdIVDtcbiAgICB9IGVsc2UgaWYgKGV2ZW50LmtleUNvZGUgPT09IGtleWNvZGVzLkxFRlQgJiYgc25ha2UuZGlyZWN0aW9uICE9PSBkaXJlY3Rpb25zLlJJR0hUKSB7XG4gICAgICBzbmFrZS5kaXJlY3Rpb24gPSBkaXJlY3Rpb25zLkxFRlQ7XG4gICAgfVxuXG4gICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IGtleWNvZGVzLlNQQUNFKSB7XG4gICAgICBnYW1lLnN0YXJ0KCk7XG4gICAgfVxuICB9LFxuXG4gIHJ1bih0aW1lc3RhbXApIHtcbiAgICB0aGlzLnJhZiA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5ydW4uYmluZCh0aGlzKSk7XG5cbiAgICBpZiAoKHRpbWVzdGFtcCAtIHRoaXMubGFzdFRpY2spIDwgdGhpcy5zcGVlZCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLmxhc3RUaWNrID0gdGltZXN0YW1wO1xuXG4gICAgdGhpcy5ib2FyZC5kcmF3KCk7XG4gIH1cbn0pO1xuXG5leHBvcnRcbmRlZmF1bHQgZ2FtZTtcbiIsImltcG9ydCBnYW1lIGZyb20gJy4vZ2FtZS5qcyc7XG5cbmdhbWUuc3RhcnQoKTtcbiIsInZhciBkaXJlY3Rpb25zID0ge1xuXHRVUDogMSxcblx0RE9XTjogMixcblx0TEVGVDogNCxcblx0UklHSFQ6IDhcbn07XG5cbnZhciBrZXljb2RlcyA9IHtcblx0VVA6IDM4LFxuXHRET1dOOiA0MCxcblx0UklHSFQ6IDM5LFxuXHRMRUZUOiAzNyxcblx0U1BBQ0U6IDMyXG59O1xuXG5leHBvcnRcbmRlZmF1bHQge1xuXHRkaXJlY3Rpb25zLFxuXHRrZXljb2Rlc1xufTtcbiIsInZhciBzbmFrZVByb3RvID0ge1xuXHRnZXRMZW5ndGgoKSB7XG5cdFx0cmV0dXJuIHRoaXMuYm9keVBhcnRzLmxlbmd0aDtcblx0fSxcblxuXHRnZXRIZWFkKCkge1xuXHRcdHJldHVybiB0aGlzLmJvZHlQYXJ0c1swXTtcblx0fSxcblxuXHRnZXRUYWlsKCkge1xuXHRcdHJldHVybiB0aGlzLmJvZHlQYXJ0c1t0aGlzLmJvZHlQYXJ0cy5sZW5ndGggLSAxXTtcblx0fSxcbn07XG5cbmV4cG9ydFxuZGVmYXVsdCBzbmFrZVByb3RvO1xuIiwiaW1wb3J0IGdhbWUgZnJvbSAnLi9nYW1lLmpzJztcblxudmFyIHRpbGVQcm90byA9IHtcbiAgcGFpbnRTbmFrZVBhcnQoKSB7XG4gICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ29uJyk7XG4gICAgaWYgKHRoaXMub2NjdXBpZWRCeS5pc0hlYWQpIHtcbiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdoZWFkJyk7XG4gICAgfVxuICB9LFxuXG4gIGNsZWFyVGlsZSgpIHtcbiAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnb24nLCAnaGVhZCcpO1xuICB9LFxuXG4gIGFkZFNuYWtlUGFydChzbmFrZVBhcnQpIHtcbiAgICBpZiAodGhpcy5oYXNGcnVpdCkge1xuICAgICAgdGhpcy5yZW1vdmVGcnVpdCgpO1xuICAgICAgZ2FtZS51cGRhdGVTY29yZSgpO1xuICAgICAgdmFyIGJvZHkgPSBPYmplY3QuY3JlYXRlKHt9KTtcbiAgICAgIHZhciB0YWlsVGlsZSA9IGdhbWUuYm9hcmQuc25ha2UuYm9keVBhcnRzW2dhbWUuYm9hcmQuc25ha2UuYm9keVBhcnRzLmxlbmd0aCAtIDFdLnRpbGU7XG4gICAgICBib2R5LnRpbGUgPSB0YWlsVGlsZS5hZGRTbmFrZVBhcnQoYm9keSk7XG4gICAgICBnYW1lLmJvYXJkLnNuYWtlLmJvZHlQYXJ0cy5wdXNoKGJvZHkpO1xuICAgICAgZ2FtZS5ib2FyZC5hZGRGcnVpdCgpO1xuICAgIH0gZWxzZSBpZiAoc25ha2VQYXJ0LmlzSGVhZCAmJiB0aGlzLm9jY3VwaWVkQnkpIHtcbiAgICAgIGdhbWUuZ2FtZU92ZXIoKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5vY2N1cGllZEJ5ID0gc25ha2VQYXJ0O1xuICAgIHNuYWtlUGFydC50aWxlID0gdGhpcztcbiAgICB0aGlzLnBhaW50U25ha2VQYXJ0KCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgcmVtb3ZlU25ha2VQYXJ0KCkge1xuICAgIHRoaXMub2NjdXBpZWRCeSA9IG51bGw7XG4gICAgdGhpcy5jbGVhclRpbGUoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBoYXNTbmFrZVBhcnQoKSB7XG4gICAgcmV0dXJuIHRoaXMub2NjdXBpZWRCeSAhPSBudWxsO1xuICB9LFxuXG4gIGFkZEZydWl0KCkge1xuICAgIHRoaXMuaGFzRnJ1aXQgPSB0cnVlO1xuICAgIHRoaXMucGFpbnRGcnVpdCgpO1xuICB9LFxuXG4gIHJlbW92ZUZydWl0KCkge1xuICAgIHRoaXMuaGFzRnJ1aXQgPSBmYWxzZTtcbiAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZnJ1aXQnKTtcbiAgfSxcblxuICBwYWludEZydWl0KCkge1xuICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdmcnVpdCcpO1xuICB9XG59O1xuXG5leHBvcnRcbmRlZmF1bHQgdGlsZVByb3RvO1xuIl19
