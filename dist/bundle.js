(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _tileProtoJs = require('./tileProto.js');

var _tileProtoJs2 = _interopRequireDefault(_tileProtoJs);

var _snakeProtoJs = require('./snakeProto.js');

var _snakeProtoJs2 = _interopRequireDefault(_snakeProtoJs);

var _settingsJs = require('./settings.js');

var _settingsJs2 = _interopRequireDefault(_settingsJs);

var boardProto = {

  getTileAt: function getTileAt(row, col) {
    var rowObj = this.rows[row];
    return rowObj.tiles[col];
  },

  addFruit: function addFruit() {

    var isTileOccupied = true;
    do {
      var rndRow = Math.floor(Math.random() * this.numRows);
      var rndCol = Math.floor(Math.random() * this.numCols);
      var tile = this.getTileAt(rndRow, rndCol);
      isTileOccupied = !!tile.occupiedBy;
    } while (isTileOccupied);

    tile.addFruit();
  },

  createMatrix: function createMatrix(boardElement) {

    this.rows = [];
    this.fragment = document.createDocumentFragment();
    var row, col;

    for (var i = 0; i < this.numRows; i++) {
      row = document.createElement('div');
      row.classList.add('row');

      var rowObj = Object.create(null);
      rowObj.index = i;
      rowObj.tiles = [];

      for (var j = 0; j < this.numCols; j++) {
        col = document.createElement('div');
        col.classList.add('col');
        row.appendChild(col);

        var tile = Object.create(_tileProtoJs2['default']);
        tile.index = j;
        tile.row = i;
        tile.col = j;
        tile.occupiedBy = null;

        tile.element = col;
        rowObj.tiles.push(tile);
      }
      this.rows.push(rowObj);
      this.fragment.appendChild(row);
    }
    boardElement.appendChild(this.fragment);
  },

  createSnake: function createSnake() {
    var directions = _settingsJs2['default'].directions;
    var snake = Object.create(_snakeProtoJs2['default']);

    snake.direction = directions.RIGHT;
    snake.bodyParts = [];

    var head = Object.create({});
    head.isHead = true;
    head.tile = this.rows[4].tiles[5].addSnakePart(head);
    snake.bodyParts.push(head);

    var body = Object.create({});
    body.tile = this.rows[4].tiles[4].addSnakePart(body);
    snake.bodyParts.push(body);

    var body = Object.create({});
    body.tile = this.rows[4].tiles[3].addSnakePart(body);
    snake.bodyParts.push(body);

    this.snake = snake;
  },

  clear: function clear(game) {
    this.snake = null;
    game.boardElement.innerHTML = null;
    game.scoreElement.innerHTML = '0';
  },

  draw: function draw(snake) {
    var snakeHead = this.snake.getHead();
    var moveToRow, moveToCol;
    var directions = _settingsJs2['default'].directions;

    switch (this.snake.direction) {
      case directions.UP:
        moveToRow = snakeHead.tile.row - 1;
        moveToCol = snakeHead.tile.col;
        break;
      case directions.DOWN:
        moveToRow = snakeHead.tile.row + 1;
        moveToCol = snakeHead.tile.col;
        break;
      case directions.RIGHT:
        moveToRow = snakeHead.tile.row;
        moveToCol = snakeHead.tile.col + 1;
        break;
      case directions.LEFT:
        moveToRow = snakeHead.tile.row;
        moveToCol = snakeHead.tile.col - 1;
        break;
    }

    if (moveToRow < 0) {
      moveToRow = this.numRows - 1;
    } else if (moveToRow > this.numRows - 1) {
      moveToRow = 0;
    } else if (moveToCol > this.numRows - 1) {
      moveToCol = 0;
    } else if (moveToCol < 0) {
      moveToCol = this.numRows - 1;
    }

    var moveToTile = this.getTileAt(moveToRow, moveToCol);

    for (var b = 0; b < this.snake.bodyParts.length; b++) {

      var currentBodyPart = this.snake.bodyParts[b];
      var prevTile = currentBodyPart.tile;

      currentBodyPart.tile = moveToTile.addSnakePart(currentBodyPart);
      if (currentBodyPart.tile === false) {
        break;
      }
      prevTile.removeSnakePart();
      moveToTile = prevTile;
    }
  }
};

exports['default'] = boardProto;
module.exports = exports['default'];

},{"./settings.js":4,"./snakeProto.js":5,"./tileProto.js":6}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _boardProtoJs = require('./boardProto.js');

var _boardProtoJs2 = _interopRequireDefault(_boardProtoJs);

var _settingsJs = require('./settings.js');

var _settingsJs2 = _interopRequireDefault(_settingsJs);

var game = Object.create({
  updateScore: function updateScore() {
    this.score += this.nextScore;
    this.scoreElement.innerHTML = this.score;
    this.speed -= 1;
    this.nextScore += 5;
  },

  resetScore: function resetScore() {
    this.score = 0;
    this.scoreElement.innerHTML = this.score;
  },

  gameOver: function gameOver() {
    window.cancelAnimationFrame(this.raf);
  },

  start: function start() {
    this.boardElement = document.getElementById('board');
    this.scoreElement = document.getElementById('score');

    if (this.board) {
      this.board.clear(this);
    }

    this.gameOver();
    this.resetScore();

    this.board = Object.create(_boardProtoJs2['default']);
    this.board.numRows = 20;
    this.board.numCols = 20;
    this.board.createMatrix(this.boardElement);

    this.board.createSnake();
    this.board.addFruit();

    this.score = 0;
    this.speed = 100;
    this.lastTick = 0;
    this.nextScore = 10;

    this.listen();

    window.requestAnimationFrame(this.run.bind(this));
  },

  listen: function listen() {
    if (this.listener) {
      document.removeEventListener('keydown', this.listener);
    }
    this.listener = this.keys.bind(this);
    document.addEventListener('keydown', this.listener);
  },

  keys: function keys(event) {

    var snake = this.board.snake,
        keycodes = _settingsJs2['default'].keycodes,
        directions = _settingsJs2['default'].directions;

    if (event.keyCode === keycodes.UP && snake.direction !== directions.DOWN) {
      snake.direction = directions.UP;
    } else if (event.keyCode === keycodes.DOWN && snake.direction !== directions.UP) {
      snake.direction = directions.DOWN;
    } else if (event.keyCode === keycodes.RIGHT && snake.direction !== directions.LEFT) {
      snake.direction = directions.RIGHT;
    } else if (event.keyCode === keycodes.LEFT && snake.direction !== directions.RIGHT) {
      snake.direction = directions.LEFT;
    }

    if (event.keyCode === keycodes.SPACE) {
      game.start();
    }
  },

  run: function run(timestamp) {
    this.raf = window.requestAnimationFrame(this.run.bind(this));

    if (timestamp - this.lastTick < this.speed) {
      return false;
    }
    this.lastTick = timestamp;

    this.board.draw();
  }
});

exports['default'] = game;
module.exports = exports['default'];

},{"./boardProto.js":1,"./settings.js":4}],3:[function(require,module,exports){
'use strict';

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _gameJs = require('./game.js');

var _gameJs2 = _interopRequireDefault(_gameJs);

if ((window.location.port === 80 || !window.location.port) && window.location.protocol !== 'https:') {
	window.location.protocol = 'https:';
}

_gameJs2['default'].start();

if ('serviceWorker' in navigator) {
	navigator.serviceWorker.register('./sw.js').then(function (ok) {
		console.log('SW registered', ok);
	})['catch'](function (err) {
		console.log('SW error', err);
	});
}

},{"./game.js":2}],4:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
	value: true
});
var directions = {
	UP: 1,
	DOWN: 2,
	LEFT: 4,
	RIGHT: 8
};

var keycodes = {
	UP: 38,
	DOWN: 40,
	RIGHT: 39,
	LEFT: 37,
	SPACE: 32
};

exports["default"] = {
	directions: directions,
	keycodes: keycodes
};
module.exports = exports["default"];

},{}],5:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
	value: true
});
var snakeProto = {
	getLength: function getLength() {
		return this.bodyParts.length;
	},

	getHead: function getHead() {
		return this.bodyParts[0];
	},

	getTail: function getTail() {
		return this.bodyParts[this.bodyParts.length - 1];
	}
};

exports["default"] = snakeProto;
module.exports = exports["default"];

},{}],6:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _gameJs = require('./game.js');

var _gameJs2 = _interopRequireDefault(_gameJs);

var tileProto = {
  paintSnakePart: function paintSnakePart() {
    this.element.classList.add('on');
    if (this.occupiedBy.isHead) {
      this.element.classList.add('head');
    }
  },

  clearTile: function clearTile() {
    this.element.classList.remove('on', 'head');
  },

  addSnakePart: function addSnakePart(snakePart) {
    if (this.hasFruit) {
      this.removeFruit();
      _gameJs2['default'].updateScore();
      var body = Object.create({});
      var tailTile = _gameJs2['default'].board.snake.bodyParts[_gameJs2['default'].board.snake.bodyParts.length - 1].tile;
      body.tile = tailTile.addSnakePart(body);
      _gameJs2['default'].board.snake.bodyParts.push(body);
      _gameJs2['default'].board.addFruit();
    } else if (snakePart.isHead && this.occupiedBy) {
      _gameJs2['default'].gameOver();
      return false;
    }
    this.occupiedBy = snakePart;
    snakePart.tile = this;
    this.paintSnakePart();
    return this;
  },

  removeSnakePart: function removeSnakePart() {
    this.occupiedBy = null;
    this.clearTile();
    return this;
  },

  hasSnakePart: function hasSnakePart() {
    return this.occupiedBy != null;
  },

  addFruit: function addFruit() {
    this.hasFruit = true;
    this.paintFruit();
  },

  removeFruit: function removeFruit() {
    this.hasFruit = false;
    this.element.classList.remove('fruit');
  },

  paintFruit: function paintFruit() {
    this.element.classList.add('fruit');
  }
};

exports['default'] = tileProto;
module.exports = exports['default'];

},{"./game.js":2}]},{},[3])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvc3RlZmFuYnJ1dmlrL2dpdC9zbmFrZS9zcmMvYm9hcmRQcm90by5qcyIsIi9Vc2Vycy9zdGVmYW5icnV2aWsvZ2l0L3NuYWtlL3NyYy9nYW1lLmpzIiwiL1VzZXJzL3N0ZWZhbmJydXZpay9naXQvc25ha2Uvc3JjL2luZGV4LmpzIiwiL1VzZXJzL3N0ZWZhbmJydXZpay9naXQvc25ha2Uvc3JjL3NldHRpbmdzLmpzIiwiL1VzZXJzL3N0ZWZhbmJydXZpay9naXQvc25ha2Uvc3JjL3NuYWtlUHJvdG8uanMiLCIvVXNlcnMvc3RlZmFuYnJ1dmlrL2dpdC9zbmFrZS9zcmMvdGlsZVByb3RvLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7MkJDQXNCLGdCQUFnQjs7Ozs0QkFDZixpQkFBaUI7Ozs7MEJBQ25CLGVBQWU7Ozs7QUFFcEMsSUFBSSxVQUFVLEdBQUc7O0FBRWYsV0FBUyxFQUFBLG1CQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUU7QUFDbEIsUUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUM1QixXQUFPLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7R0FDMUI7O0FBRUQsVUFBUSxFQUFBLG9CQUFHOztBQUVULFFBQUksY0FBYyxHQUFHLElBQUksQ0FBQztBQUMxQixPQUFHO0FBQ0QsVUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQ3RELFVBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUN0RCxVQUFJLElBQUksR0FBRyxJQUFJ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Q2hDOztBQUVELFVBQVEsRUFBQSxvQkFBRztBQUNULFFBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO0FBQ3JCLFFBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztHQUNuQjs7QUFFRCxhQUFXLEVBQUEsdUJBQUc7QUFDWixRQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztBQUN0QixRQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7R0FDeEM7O0FBRUQsWUFBVSxFQUFBLHNCQUFHO0FBQ1gsUUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0dBQ3JDO0NBQ0YsQ0FBQzs7cUJBR00sU0FBUyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJpbXBvcnQgdGlsZVByb3RvIGZyb20gJy4vdGlsZVByb3RvLmpzJztcbmltcG9ydCBzbmFrZVByb3RvIGZyb20gJy4vc25ha2VQcm90by5qcyc7XG5pbXBvcnQgc2V0dGluZ3MgZnJvbSAnLi9zZXR0aW5ncy5qcyc7XG5cbnZhciBib2FyZFByb3RvID0ge1xuXG4gIGdldFRpbGVBdChyb3csIGNvbCkge1xuICAgIHZhciByb3dPYmogPSB0aGlzLnJvd3Nbcm93XTtcbiAgICByZXR1cm4gcm93T2JqLnRpbGVzW2NvbF07XG4gIH0sXG5cbiAgYWRkRnJ1aXQoKSB7XG5cbiAgICB2YXIgaXNUaWxlT2NjdXBpZWQgPSB0cnVlO1xuICAgIGRvIHtcbiAgICAgIHZhciBybmRSb3cgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLm51bVJvd3MpO1xuICAgICAgdmFyIHJuZENvbCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMubnVtQ29scyk7XG4gICAgICB2YXIgdGlsZSA9IHRoaXMuZ2V0VGlsZUF0KHJuZFJvdywgcm5kQ29sKTtcbiAgICAgIGlzVGlsZU9jY3VwaWVkID0gISF0aWxlLm9jY3VwaWVkQnk7XG4gICAgfSB3aGlsZSAoaXNUaWxlT2NjdXBpZWQpO1xuXG4gICAgdGlsZS5hZGRGcnVpdCgpO1xuICB9LFxuXG4gIGNyZWF0ZU1hdHJpeChib2FyZEVsZW1lbnQpIHtcblxuICAgIHRoaXMucm93cyA9IFtdO1xuICAgIHRoaXMuZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgdmFyIHJvdywgY29sO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm51bVJvd3M7IGkrKykge1xuICAgICAgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICByb3cuY2xhc3NMaXN0LmFkZCgncm93Jyk7XG5cbiAgICAgIHZhciByb3dPYmogPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgICAgcm93T2JqLmluZGV4ID0gaTtcbiAgICAgIHJvd09iai50aWxlcyA9IFtdO1xuXG4gICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMubnVtQ29sczsgaisrKSB7XG4gICAgICAgIGNvbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBjb2wuY2xhc3NMaXN0LmFkZCgnY29sJyk7XG4gICAgICAgIHJvdy5hcHBlbmRDaGlsZChjb2wpO1xuXG4gICAgICAgIHZhciB0aWxlID0gT2JqZWN0LmNyZWF0ZSh0aWxlUHJvdG8pO1xuICAgICAgICB0aWxlLmluZGV4ID0gajtcbiAgICAgICAgdGlsZS5yb3cgPSBpO1xuICAgICAgICB0aWxlLmNvbCA9IGo7XG4gICAgICAgIHRpbGUub2NjdXBpZWRCeSA9IG51bGw7XG5cbiAgICAgICAgdGlsZS5lbGVtZW50ID0gY29sO1xuICAgICAgICByb3dPYmoudGlsZXMucHVzaCh0aWxlKTtcbiAgICAgIH1cbiAgICAgIHRoaXMucm93cy5wdXNoKHJvd09iaik7XG4gICAgICB0aGlzLmZyYWdtZW50LmFwcGVuZENoaWxkKHJvdyk7XG4gICAgfVxuICAgIGJvYXJkRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmZyYWdtZW50KTtcbiAgfSxcblxuICBjcmVhdGVTbmFrZSgpIHtcbiAgICB2YXIgZGlyZWN0aW9ucyA9IHNldHRpbmdzLmRpcmVjdGlvbnM7XG4gICAgdmFyIHNuYWtlID0gT2JqZWN0LmNyZWF0ZShzbmFrZVByb3RvKTtcblxuICAgIHNuYWtlLmRpcmVjdGlvbiA9IGRpcmVjdGlvbnMuUklHSFQ7XG4gICAgc25ha2UuYm9keVBhcnRzID0gW107XG5cbiAgICB2YXIgaGVhZCA9IE9iamVjdC5jcmVhdGUoe30pO1xuICAgIGhlYWQuaXNIZWFkID0gdHJ1ZTtcbiAgICBoZWFkLnRpbGUgPSB0aGlzLnJvd3NbNF0udGlsZXNbNV0uYWRkU25ha2VQYXJ0KGhlYWQpO1xuICAgIHNuYWtlLmJvZHlQYXJ0cy5wdXNoKGhlYWQpO1xuXG4gICAgdmFyIGJvZHkgPSBPYmplY3QuY3JlYXRlKHt9KTtcbiAgICBib2R5LnRpbGUgPSB0aGlzLnJvd3NbNF0udGlsZXNbNF0uYWRkU25ha2VQYXJ0KGJvZHkpO1xuICAgIHNuYWtlLmJvZHlQYXJ0cy5wdXNoKGJvZHkpO1xuXG4gICAgdmFyIGJvZHkgPSBPYmplY3QuY3JlYXRlKHt9KTtcbiAgICBib2R5LnRpbGUgPSB0aGlzLnJvd3NbNF0udGlsZXNbM10uYWRkU25ha2VQYXJ0KGJvZHkpO1xuICAgIHNuYWtlLmJvZHlQYXJ0cy5wdXNoKGJvZHkpO1xuXG4gICAgdGhpcy5zbmFrZSA9IHNuYWtlO1xuICB9LFxuXG4gIGNsZWFyKGdhbWUpIHtcbiAgICB0aGlzLnNuYWtlID0gbnVsbDtcbiAgICBnYW1lLmJvYXJkRWxlbWVudC5pbm5lckhUTUwgPSBudWxsO1xuICAgIGdhbWUuc2NvcmVFbGVtZW50LmlubmVySFRNTCA9ICcwJztcbiAgfSxcblxuICBkcmF3KHNuYWtlKSB7XG4gICAgdmFyIHNuYWtlSGVhZCA9IHRoaXMuc25ha2UuZ2V0SGVhZCgpO1xuICAgIHZhciBtb3ZlVG9Sb3csIG1vdmVUb0NvbDtcbiAgICB2YXIgZGlyZWN0aW9ucyA9IHNldHRpbmdzLmRpcmVjdGlvbnM7XG5cbiAgICBzd2l0Y2ggKHRoaXMuc25ha2UuZGlyZWN0aW9uKSB7XG4gICAgICBjYXNlIGRpcmVjdGlvbnMuVVA6XG4gICAgICAgIG1vdmVUb1JvdyA9IHNuYWtlSGVhZC50aWxlLnJvdyAtIDE7XG4gICAgICAgIG1vdmVUb0NvbCA9IHNuYWtlSGVhZC50aWxlLmNvbDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIGRpcmVjdGlvbnMuRE9XTjpcbiAgICAgICAgbW92ZVRvUm93ID0gc25ha2VIZWFkLnRpbGUucm93ICsgMTtcbiAgICAgICAgbW92ZVRvQ29sID0gc25ha2VIZWFkLnRpbGUuY29sO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgZGlyZWN0aW9ucy5SSUdIVDpcbiAgICAgICAgbW92ZVRvUm93ID0gc25ha2VIZWFkLnRpbGUucm93O1xuICAgICAgICBtb3ZlVG9Db2wgPSBzbmFrZUhlYWQudGlsZS5jb2wgKyAxO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgZGlyZWN0aW9ucy5MRUZUOlxuICAgICAgICBtb3ZlVG9Sb3cgPSBzbmFrZUhlYWQudGlsZS5yb3c7XG4gICAgICAgIG1vdmVUb0NvbCA9IHNuYWtlSGVhZC50aWxlLmNvbCAtIDE7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIGlmIChtb3ZlVG9Sb3cgPCAwKSB7XG4gICAgICBtb3ZlVG9Sb3cgPSB0aGlzLm51bVJvd3MgLSAxO1xuICAgIH0gZWxzZSBpZiAobW92ZVRvUm93ID4gdGhpcy5udW1Sb3dzIC0gMSkge1xuICAgICAgbW92ZVRvUm93ID0gMDtcbiAgICB9IGVsc2UgaWYgKG1vdmVUb0NvbCA+IHRoaXMubnVtUm93cyAtIDEpIHtcbiAgICAgIG1vdmVUb0NvbCA9IDA7XG4gICAgfSBlbHNlIGlmIChtb3ZlVG9Db2wgPCAwKSB7XG4gICAgICBtb3ZlVG9Db2wgPSB0aGlzLm51bVJvd3MgLSAxO1xuICAgIH1cblxuICAgIHZhciBtb3ZlVG9UaWxlID0gdGhpcy5nZXRUaWxlQXQobW92ZVRvUm93LCBtb3ZlVG9Db2wpO1xuXG4gICAgZm9yICh2YXIgYiA9IDA7IGIgPCB0aGlzLnNuYWtlLmJvZHlQYXJ0cy5sZW5ndGg7IGIrKykge1xuXG4gICAgICB2YXIgY3VycmVudEJvZHlQYXJ0ID0gdGhpcy5zbmFrZS5ib2R5UGFydHNbYl07XG4gICAgICB2YXIgcHJldlRpbGUgPSBjdXJyZW50Qm9keVBhcnQudGlsZTtcblxuICAgICAgY3VycmVudEJvZHlQYXJ0LnRpbGUgPSBtb3ZlVG9UaWxlLmFkZFNuYWtlUGFydChjdXJyZW50Qm9keVBhcnQpO1xuICAgICAgaWYgKGN1cnJlbnRCb2R5UGFydC50aWxlID09PSBmYWxzZSkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIHByZXZUaWxlLnJlbW92ZVNuYWtlUGFydCgpO1xuICAgICAgbW92ZVRvVGlsZSA9IHByZXZUaWxlO1xuICAgIH1cbiAgfVxufTtcblxuZXhwb3J0XG5kZWZhdWx0IGJvYXJkUHJvdG87XG4iLCJpbXBvcnQgYm9hcmRQcm90byBmcm9tICcuL2JvYXJkUHJvdG8uanMnO1xuaW1wb3J0IHNldHRpbmdzIGZyb20gJy4vc2V0dGluZ3MuanMnO1xuXG52YXIgZ2FtZSA9IE9iamVjdC5jcmVhdGUoe1xuICB1cGRhdGVTY29yZSgpIHtcbiAgICB0aGlzLnNjb3JlICs9IHRoaXMubmV4dFNjb3JlO1xuICAgIHRoaXMuc2NvcmVFbGVtZW50LmlubmVySFRNTCA9IHRoaXMuc2NvcmU7XG4gICAgdGhpcy5zcGVlZCAtPSAxO1xuICAgIHRoaXMubmV4dFNjb3JlICs9IDU7XG4gIH0sXG5cbiAgcmVzZXRTY29yZSgpIHtcbiAgICB0aGlzLnNjb3JlID0gMDtcbiAgICB0aGlzLnNjb3JlRWxlbWVudC5pbm5lckhUTUwgPSB0aGlzLnNjb3JlO1xuICB9LFxuXG4gIGdhbWVPdmVyKCkge1xuICAgIHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLnJhZik7XG4gIH0sXG5cbiAgc3RhcnQoKSB7XG4gICAgdGhpcy5ib2FyZEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYm9hcmQnKTtcbiAgICB0aGlzLnNjb3JlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY29yZScpO1xuXG4gICAgaWYgKHRoaXMuYm9hcmQpIHtcbiAgICAgIHRoaXMuYm9hcmQuY2xlYXIodGhpcyk7XG4gICAgfVxuXG4gICAgdGhpcy5nYW1lT3ZlcigpO1xuICAgIHRoaXMucmVzZXRTY29yZSgpO1xuXG4gICAgdGhpcy5ib2FyZCA9IE9iamVjdC5jcmVhdGUoYm9hcmRQcm90byk7XG4gICAgdGhpcy5ib2FyZC5udW1Sb3dzID0gMjA7XG4gICAgdGhpcy5ib2FyZC5udW1Db2xzID0gMjA7XG4gICAgdGhpcy5ib2FyZC5jcmVhdGVNYXRyaXgodGhpcy5ib2FyZEVsZW1lbnQpO1xuXG4gICAgdGhpcy5ib2FyZC5jcmVhdGVTbmFrZSgpO1xuICAgIHRoaXMuYm9hcmQuYWRkRnJ1aXQoKTtcblxuICAgIHRoaXMuc2NvcmUgPSAwO1xuICAgIHRoaXMuc3BlZWQgPSAxMDA7XG4gICAgdGhpcy5sYXN0VGljayA9IDA7XG4gICAgdGhpcy5uZXh0U2NvcmUgPSAxMDtcblxuICAgIHRoaXMubGlzdGVuKCk7XG5cbiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMucnVuLmJpbmQodGhpcykpO1xuICB9LFxuXG4gIGxpc3RlbigpIHtcbiAgICBpZiAodGhpcy5saXN0ZW5lcikge1xuICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMubGlzdGVuZXIpO1xuICAgIH1cbiAgICB0aGlzLmxpc3RlbmVyID0gdGhpcy5rZXlzLmJpbmQodGhpcyk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMubGlzdGVuZXIpO1xuICB9LFxuXG4gIGtleXMoZXZlbnQpIHtcblxuICAgIHZhciBzbmFrZSA9IHRoaXMuYm9hcmQuc25ha2UsXG4gICAgICBrZXljb2RlcyA9IHNldHRpbmdzLmtleWNvZGVzLFxuICAgICAgZGlyZWN0aW9ucyA9IHNldHRpbmdzLmRpcmVjdGlvbnM7XG5cbiAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0ga2V5Y29kZXMuVVAgJiYgc25ha2UuZGlyZWN0aW9uICE9PSBkaXJlY3Rpb25zLkRPV04pIHtcbiAgICAgIHNuYWtlLmRpcmVjdGlvbiA9IGRpcmVjdGlvbnMuVVA7XG4gICAgfSBlbHNlIGlmIChldmVudC5rZXlDb2RlID09PSBrZXljb2Rlcy5ET1dOICYmIHNuYWtlLmRpcmVjdGlvbiAhPT0gZGlyZWN0aW9ucy5VUCkge1xuICAgICAgc25ha2UuZGlyZWN0aW9uID0gZGlyZWN0aW9ucy5ET1dOO1xuICAgIH0gZWxzZSBpZiAoZXZlbnQua2V5Q29kZSA9PT0ga2V5Y29kZXMuUklHSFQgJiYgc25ha2UuZGlyZWN0aW9uICE9PSBkaXJlY3Rpb25zLkxFRlQpIHtcbiAgICAgIHNuYWtlLmRpcmVjdGlvbiA9IGRpcmVjdGlvbnMuUklHSFQ7XG4gICAgfSBlbHNlIGlmIChldmVudC5rZXlDb2RlID09PSBrZXljb2Rlcy5MRUZUICYmIHNuYWtlLmRpcmVjdGlvbiAhPT0gZGlyZWN0aW9ucy5SSUdIVCkge1xuICAgICAgc25ha2UuZGlyZWN0aW9uID0gZGlyZWN0aW9ucy5MRUZUO1xuICAgIH1cblxuICAgIGlmIChldmVudC5rZXlDb2RlID09PSBrZXljb2Rlcy5TUEFDRSkge1xuICAgICAgZ2FtZS5zdGFydCgpO1xuICAgIH1cbiAgfSxcblxuICBydW4odGltZXN0YW1wKSB7XG4gICAgdGhpcy5yYWYgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMucnVuLmJpbmQodGhpcykpO1xuXG4gICAgaWYgKCh0aW1lc3RhbXAgLSB0aGlzLmxhc3RUaWNrKSA8IHRoaXMuc3BlZWQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5sYXN0VGljayA9IHRpbWVzdGFtcDtcblxuICAgIHRoaXMuYm9hcmQuZHJhdygpO1xuICB9XG59KTtcblxuZXhwb3J0XG5kZWZhdWx0IGdhbWU7XG4iLCJpbXBvcnQgZ2FtZSBmcm9tICcuL2dhbWUuanMnO1xuXG5pZiAoKHdpbmRvdy5sb2NhdGlvbi5wb3J0ID09PSA4MCB8fCAhd2luZG93LmxvY2F0aW9uLnBvcnQpICYmIHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCAhPT0gJ2h0dHBzOicpIHtcblx0d2luZG93LmxvY2F0aW9uLnByb3RvY29sID0gJ2h0dHBzOic7XG59XG5cbmdhbWUuc3RhcnQoKTtcblxuaWYgKCdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpIHtcblx0bmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJy4vc3cuanMnKS50aGVuKGZ1bmN0aW9uKG9rKSB7XG5cdFx0Y29uc29sZS5sb2coJ1NXIHJlZ2lzdGVyZWQnLCBvayk7XG5cdH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xuXHRcdGNvbnNvbGUubG9nKCdTVyBlcnJvcicsIGVycik7XG5cdH0pO1xufVxuIiwidmFyIGRpcmVjdGlvbnMgPSB7XG5cdFVQOiAxLFxuXHRET1dOOiAyLFxuXHRMRUZUOiA0LFxuXHRSSUdIVDogOFxufTtcblxudmFyIGtleWNvZGVzID0ge1xuXHRVUDogMzgsXG5cdERPV046IDQwLFxuXHRSSUdIVDogMzksXG5cdExFRlQ6IDM3LFxuXHRTUEFDRTogMzJcbn07XG5cbmV4cG9ydFxuZGVmYXVsdCB7XG5cdGRpcmVjdGlvbnMsXG5cdGtleWNvZGVzXG59O1xuIiwidmFyIHNuYWtlUHJvdG8gPSB7XG5cdGdldExlbmd0aCgpIHtcblx0XHRyZXR1cm4gdGhpcy5ib2R5UGFydHMubGVuZ3RoO1xuXHR9LFxuXG5cdGdldEhlYWQoKSB7XG5cdFx0cmV0dXJuIHRoaXMuYm9keVBhcnRzWzBdO1xuXHR9LFxuXG5cdGdldFRhaWwoKSB7XG5cdFx0cmV0dXJuIHRoaXMuYm9keVBhcnRzW3RoaXMuYm9keVBhcnRzLmxlbmd0aCAtIDFdO1xuXHR9LFxufTtcblxuZXhwb3J0XG5kZWZhdWx0IHNuYWtlUHJvdG87XG4iLCJpbXBvcnQgZ2FtZSBmcm9tICcuL2dhbWUuanMnO1xuXG52YXIgdGlsZVByb3RvID0ge1xuICBwYWludFNuYWtlUGFydCgpIHtcbiAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnb24nKTtcbiAgICBpZiAodGhpcy5vY2N1cGllZEJ5LmlzSGVhZCkge1xuICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2hlYWQnKTtcbiAgICB9XG4gIH0sXG5cbiAgY2xlYXJUaWxlKCkge1xuICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdvbicsICdoZWFkJyk7XG4gIH0sXG5cbiAgYWRkU25ha2VQYXJ0KHNuYWtlUGFydCkge1xuICAgIGlmICh0aGlzLmhhc0ZydWl0KSB7XG4gICAgICB0aGlzLnJlbW92ZUZydWl0KCk7XG4gICAgICBnYW1lLnVwZGF0ZVNjb3JlKCk7XG4gICAgICB2YXIgYm9keSA9IE9iamVjdC5jcmVhdGUoe30pO1xuICAgICAgdmFyIHRhaWxUaWxlID0gZ2FtZS5ib2FyZC5zbmFrZS5ib2R5UGFydHNbZ2FtZS5ib2FyZC5zbmFrZS5ib2R5UGFydHMubGVuZ3RoIC0gMV0udGlsZTtcbiAgICAgIGJvZHkudGlsZSA9IHRhaWxUaWxlLmFkZFNuYWtlUGFydChib2R5KTtcbiAgICAgIGdhbWUuYm9hcmQuc25ha2UuYm9keVBhcnRzLnB1c2goYm9keSk7XG4gICAgICBnYW1lLmJvYXJkLmFkZEZydWl0KCk7XG4gICAgfSBlbHNlIGlmIChzbmFrZVBhcnQuaXNIZWFkICYmIHRoaXMub2NjdXBpZWRCeSkge1xuICAgICAgZ2FtZS5nYW1lT3ZlcigpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLm9jY3VwaWVkQnkgPSBzbmFrZVBhcnQ7XG4gICAgc25ha2VQYXJ0LnRpbGUgPSB0aGlzO1xuICAgIHRoaXMucGFpbnRTbmFrZVBhcnQoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICByZW1vdmVTbmFrZVBhcnQoKSB7XG4gICAgdGhpcy5vY2N1cGllZEJ5ID0gbnVsbDtcbiAgICB0aGlzLmNsZWFyVGlsZSgpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIGhhc1NuYWtlUGFydCgpIHtcbiAgICByZXR1cm4gdGhpcy5vY2N1cGllZEJ5ICE9IG51bGw7XG4gIH0sXG5cbiAgYWRkRnJ1aXQoKSB7XG4gICAgdGhpcy5oYXNGcnVpdCA9IHRydWU7XG4gICAgdGhpcy5wYWludEZydWl0KCk7XG4gIH0sXG5cbiAgcmVtb3ZlRnJ1aXQoKSB7XG4gICAgdGhpcy5oYXNGcnVpdCA9IGZhbHNlO1xuICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdmcnVpdCcpO1xuICB9LFxuXG4gIHBhaW50RnJ1aXQoKSB7XG4gICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2ZydWl0Jyk7XG4gIH1cbn07XG5cbmV4cG9ydFxuZGVmYXVsdCB0aWxlUHJvdG87XG4iXX0=
